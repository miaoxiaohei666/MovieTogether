<!DOCTYPE html>
<html lang="en" style="overflow: hidden;">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/base.css">
    <title>好友列表</title>

    <style>
        * {
            padding: 0;
            margin: 0;
        }

        .center {
            background-color: white;
            width: 700px;
            height: 100vh;
            position: relative;
            margin: 0 auto;
            opacity: 0.8;
        }

        .id {
            font-weight: 400;
            letter-spacing: 5px;
            font-size: 40px;
            position: relative;
            left: 30px;
            top: 10px;
        }

        .re {
            height: 50px;
            margin-left: 30px;
            margin-right: 30px;
            position: relative;
            top: 30px;
            background-color: lightgray;
            font-size: 20px;
            border-radius: 10px;
            line-height: 50px;
        }

        .receive {
            float: right;
            margin-right: 20px;
        }

        .new {
            position: relative;
            left: 20px;
        }

        /*.box{*/
        /*    position: relative;*/
        /*    top: 50px;*/
        /*    */
        /*}*/
        td {
            background-color: lightgray;
            position: relative;
            left: 50px;
            top: 50px;
            border: 2px solid white;
            width: 600px;
            padding-left: 10px;
        }

        .button1 {
            background-color: rgb(102, 179, 247);
            width: 50px;
            height: 30px;
            position: relative;
            top: 50px;
            border: 0;
            color: white;
            border-radius: 15px;
            line-height: 30px;
            margin-top: 10px;
            left: -80px;
        }

        .button2{
            background-color: rgb(226, 107, 107);
            width: 50px;
            height: 30px;
            position: relative;
            top: 10px;
            border: 0;
            color: white;
            border-radius: 15px;
            line-height: 30px;
            margin-top: 10px;
            left: -10px;
        }
    </style>
</head>

<body>
<div>
    <img src="imags/背景.jpg" class="back" height="100%" width="100%"
         style="z-index: -1; position: fixed; opacity: 1.0;"/>
</div>
<div class="center">
    <div>
        <b class="id">好友列表</b>
        <img src="imags/好友列表.png" style="width: 50px; position: relative; top: 20px; left: 20px;">
    </div>

    <div class="re">
        <span class="new" onclick="location.href='invite.html' ">我的邀约</span>
    </div>

    <div class="box" id="box">

    </div>

</div>

<script>


    token = localStorage.getItem("token")
    Fetch('/friend/list', JSON.stringify({
        token: token
    }))
        .then(res => {

            if (res.list) {
                var tbody = document.getElementById('box')
                res.list.forEach(function (i) {
                    var tr = document.createElement("tr")
                    var td = document.createElement("td")
                    var cc = td.innerText = i.name

                    var button1 = document.createElement("button")
                    var button2 = document.createElement("button")
                    button1.className = "button1"
                    button2.className = "button2"
                    button1.innerText = "邀约"
                    button2.innerText = "删除"
                    tr.appendChild(td)
                    tr.appendChild(button1)
                    tr.appendChild(button2)
                    tbody.appendChild(tr)



                    button1.onclick = function() {

                        Fetch('/invite/create', JSON.stringify({
                            token: token,
                            receiver: i.id
                        }))
                            .then(res => {
                                msg = res.msg
                                alert(msg)
                            })
                    }
                    console.log(i)
                    button2.onclick = function (){
                        Fetch('/friend/delete', JSON.stringify({
                            token: token,
                            phone: i.phone,

                        }))
                            .then(res => {
                                msg = res.msg
                                alert('删除成功，请刷新查看')

                            })
                    }


                })
            }
            msg = res.msg
        })








    async function Fetch(path, body) {
        return await fetch("http://localhost:8080" + path, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            body: body,
        }).then(res => {
            return res.json()
        })
    }
</script>


</body>

</html>